__nuqasm2_ast.md 2019-04-07__

nuqasm2 Abstract Syntax Tree Implementation
-------------------------------------------

Intro
=====

nuqasm2 is a proof of concept of an OPENQASM (and potentially OPENPULSE) parser
generating an abstract syntax tree (AST) to be consumed by other code generators.

It has its own code generator `ast2circ` which can be invoked for demo purposes from the `nuqasm2` command.

That code generator can optionally be used in place of Qiskit `qiskit-terra/qiskit/qasm` by the companion project,
[`qis_job`](https://github.com/jwoehr/qis_job) which compiles and runs qasm and Qiskit `QuantumCircuit` code on a
variety of back ends and simulators.

nuqasm2 was coded without any particular comp sci angle. Here is documented what was coded, not as a prescription nor
as a proposal, but to facilitate Qiskit development.

The current as-is implementation is described unless otherwise noted.

AST Structure
=============

nuqasm2 reads OPENQASM 2.0 files, recursively descending into included files, and outputs a Python unordered dictionary which may be consumed by another module or
pretty-printed.

The dictionary has 4 string keys:

* `t_sect`	translation section
* `c_sect`	the code section
* `s_sect`	source section
* `g_sect`	gate definition section

<h3><pre>t_sect</pre></h3>

The `t_sect` is an unordered dictionary of information about the entire translation unit. The keys are as follows:

* `datetime_start` is the datetime stamp of the start of translation.
* `datetime_finish` is the datetime stamp of the end of translation.
* `filepaths` is an ordered list of filepaths visited in the translation unit.
  * It comprises the top-level source file and all included files.
  * The zero-based index of each filepath in the list is used in other sections as `filenum`.
  * The filepaths may be relative or absolute, depending on how they were expressed to the translator.
* `name` for the translation unit can be provided to the translator and defaults to `main`.

<h3><pre>c_sect</pre></h3>

The `c_sect` is an ordered list of dictionaries. Each dictionary represents one parsed entity. The entity is typically a line, though entities in qasm source code occasionally span lines.

Translation is case-agnostic and simply passes thru entities in their original case as read from source.

The keys to these entity dictionaries are as follows:

* `type` element type (discussed below)
* `filenum` zero-based index into `t_sect`'s list of files visited
* `linenum` zero-based line number in the file represented by `filenum`.
  * In the case where an entity spans lines, `linenum` always refers to the first line.
* `source` the source code for the entity, though source preservation is optional and the value of this key may be `None`
  * `source` is always present as a key in the current implementation, but probably should be omitted like `eol_comment` when source is not preserved.
* `op` is the operator if the entity is an operation.
* `param_list` is an ordered list of parameters to a parenthesized operator.
  * `param_list` is always present as a key in the current implementation, but probably should be omitted like `eol_comment` when there is no parenthesized parameter list.
* `reg_list` is an ordered list of the register arguments to an operator.
* `source_reg` is the source of measurement.
* `target_reg` is the target of measurement.
* `eol_comment` is the end-of-line comment, if any.

Not all keys are present for every type. Also, certain keys normal to a type may be present or absent depending on circumstance, for instance, `eol_comment` indicating an end-of-line comment is absent if the qasm line which was parsed contained no end-of-line comment.

The most important key is `type` which defines what sort of entity has been parsed. The keys for `type` are defined in the code as follows:

<pre><font color="#000000"><font color="#006699"><strong>class</strong></font> <font color="#9966ff">ASTType</font><font color="#000000"><strong>(</strong></font>Enum<font color="#000000"><strong>)</strong></font><font color="#006699"><strong>:</strong></font>
    <font color="#cc00cc">&quot;&quot;&quot;</font><font color="#cc00cc">Enums</font><font color="#cc00cc"> </font><font color="#cc00cc">designating</font><font color="#cc00cc"> </font><font color="#cc00cc">element</font><font color="#cc00cc"> </font><font color="#cc00cc">types</font><font color="#cc00cc">.</font><font color="#cc00cc">&quot;&quot;&quot;</font>
    UNKNOWN <font color="#000000"><strong>=</strong></font> <font color="#ff0000">0</font>
    COMMENT <font color="#000000"><strong>=</strong></font> <font color="#ff0000">100</font>
    QREG <font color="#000000"><strong>=</strong></font> <font color="#ff0000">20</font>
    CREG <font color="#000000"><strong>=</strong></font> <font color="#ff0000">30</font>
    MEASURE <font color="#000000"><strong>=</strong></font> <font color="#ff0000">40</font>
    BARRIER <font color="#000000"><strong>=</strong></font> <font color="#ff0000">50</font>
    GATE <font color="#000000"><strong>=</strong></font> <font color="#ff0000">60</font>
    OP <font color="#000000"><strong>=</strong></font> <font color="#ff0000">70</font>
    CTL <font color="#000000"><strong>=</strong></font> <font color="#ff0000">80</font>
    CTL_2 <font color="#000000"><strong>=</strong></font> <font color="#ff0000">82</font>
    BLANK <font color="#000000"><strong>=</strong></font> <font color="#ff0000">1000</font>
    DECLARATION_QASM_2_0 <font color="#000000"><strong>=</strong></font> <font color="#ff0000">2000</font>
    INCLUDE <font color="#000000"><strong>=</strong></font> <font color="#ff0000">3000</font>
</pre>

<h3><pre>s_sect</pre></h3>

If source was optionally preserved by translation `s_sect` is an ordered list of unordered dictionaries, each representing a file visited in translation. Each dictionary has 2 keys:

* `filenum` is the zero-based index into `t_sect`'s list of files visited.
* `source` is an ordered list of source code lines for the visited file.

<h3><pre>g_sect</pre></h3>

The `g_sect` is an ordered list of unordered dictionaries, each representing one `gate` definition in the source.

nuqasm2 does not expand gate definitions in the `c_sect`. The next level of translation after nuqasm2 must interpret operators in light of its own understanding supplemented by the gate definitions in the `g_sect`.

Comment lines from `include`d files appear in the `c_sect` but no gate definitions, whose source and output are entirely relegated to the `g_sect`.

Each dictionary representing a gate definition presents the following keys:

* `filenum` is the zero-based index into `t_sect`'s list of files visited.
* `linenum` is the zero-based line number in the file represented by `filenum`.
* `gate_name` is the game name.
* `gate_ops_list` is an ordered list of unordered dictionaries describing the gate being defined.
  * `op` is the gate name.
  * `op_param_list` is an ordered list of parameters  for gates taking a parenthesized parameter list. For gates without such a list the value is `None`.
  * `gate_ops_raw_list` is the original gate declaration.
  * `source` is the source code, if source is optionally preserved.


Example: `foo.qasm` which includes `foogate.inc` to demonstrate a custom gate defintion being unrolled.
----------------------
```
$ cat foo.qasm
// foo.qasm ... test nuqasm2 unroll
OPENQASM 2.0;
include "qelib1.inc";
include "foogate.inc";
qreg q[3];
creg c[3];
rx(pi/2) q[0];
foo q[0], q[1], q[2];
measure q -> c

$ cat foogate.inc
// foogate.inc
// Testing nuqasm2 unroll
// C3 gate: Toffoli
gate foo a,b,c
{
  h c;
  cx b,c; tdg c;
  cx a,c; t c;
  cx b,c; tdg c;
  cx a,c; t b; t c; h c;
  cx a,b; t a; tdg b;
  cx a,b;
}

$ nuqasm2 -c -i ${HOME}/work/QISKit/DEV/qiskit-terra/qiskit/qasm/libs:. foo.qasm 

{   'c_sect': [   {   'filenum': 0,
                      'linenum': 0,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 0,
                      'linenum': 1,
                      'source': None,
                      'type': <ASTType.DECLARATION_QASM_2_0: 2000>},
                  {   'filenum': 0,
                      'include': 'qelib1.inc',
                      'linenum': 2,
                      'source': None,
                      'type': <ASTType.INCLUDE: 3000>},
                  {   'filenum': 1,
                      'linenum': 0,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 1,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 3,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 5,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 7,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 9,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 11,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 13,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 15,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 18,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 20,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 22,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 24,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 26,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 28,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 30,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 32,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 34,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 37,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 38,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 40,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 42,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 45,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 47,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 49,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 51,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 53,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 61,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 72,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 79,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 88,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 96,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 104,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 113,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 124,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 1,
                      'linenum': 135,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 0,
                      'include': 'foogate.inc',
                      'linenum': 3,
                      'source': None,
                      'type': <ASTType.INCLUDE: 3000>},
                  {   'filenum': 2,
                      'linenum': 0,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 2,
                      'linenum': 1,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 2,
                      'linenum': 2,
                      'source': None,
                      'type': <ASTType.COMMENT: 100>},
                  {   'filenum': 0,
                      'linenum': 4,
                      'qreg_name': 'q',
                      'qreg_num': '3',
                      'source': None,
                      'type': <ASTType.QREG: 20>},
                  {   'creg_name': 'c',
                      'creg_num': '3',
                      'filenum': 0,
                      'linenum': 5,
                      'source': None,
                      'type': <ASTType.CREG: 30>},
                  {   'filenum': 0,
                      'linenum': 6,
                      'op': 'rx',
                      'param_list': ['pi/2'],
                      'reg_list': ['q[0]'],
                      'source': None,
                      'type': <ASTType.OP: 70>},
                  {   'filenum': 0,
                      'linenum': 7,
                      'op': 'foo',
                      'param_list': None,
                      'reg_list': ['q[0]', 'q[1]', 'q[2]'],
                      'source': None,
                      'type': <ASTType.OP: 70>},
                  {   'filenum': 0,
                      'linenum': 8,
                      'source': None,
                      'type': <ASTType.UNKNOWN: 0>}],
    'g_sect': [   {   'filenum': 1,
                      'gate_name': 'u3(theta,phi,lambda)',
                      'gate_ops_list': [   {   'op': 'U',
                                               'op_param_list': [   'theta',
                                                                    'phi',
                                                                    'lambda'],
                                               'op_reg_list': ['q']}],
                      'gate_ops_raw_list': ['U(theta,phi,lambda) q;'],
                      'gate_param_list': ['theta', 'phi', 'lambda'],
                      'gate_reg_list': ['q'],
                      'linenum': 6,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'u2(phi,lambda)',
                      'gate_ops_list': [   {   'op': 'U',
                                               'op_param_list': [   'pi/2',
                                                                    'phi',
                                                                    'lambda'],
                                               'op_reg_list': ['q']}],
                      'gate_ops_raw_list': ['U(pi/2,phi,lambda) q;'],
                      'gate_param_list': ['phi', 'lambda'],
                      'gate_reg_list': ['q'],
                      'linenum': 8,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'u1(lambda)',
                      'gate_ops_list': [   {   'op': 'U',
                                               'op_param_list': [   '0',
                                                                    '0',
                                                                    'lambda'],
                                               'op_reg_list': ['q']}],
                      'gate_ops_raw_list': ['U(0,0,lambda) q;'],
                      'gate_param_list': ['lambda'],
                      'gate_reg_list': ['q'],
                      'linenum': 10,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'cx',
                      'gate_ops_list': [   {   'op': 'CX',
                                               'op_param_list': None,
                                               'op_reg_list': ['c', 't']}],
                      'gate_ops_raw_list': ['CX c,t;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['c', 't'],
                      'linenum': 12,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'id',
                      'gate_ops_list': [   {   'op': 'U',
                                               'op_param_list': ['0', '0', '0'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['U(0,0,0) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 14,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'u0(gamma)',
                      'gate_ops_list': [   {   'op': 'U',
                                               'op_param_list': ['0', '0', '0'],
                                               'op_reg_list': ['q']}],
                      'gate_ops_raw_list': ['U(0,0,0) q;'],
                      'gate_param_list': ['gamma'],
                      'gate_reg_list': ['q'],
                      'linenum': 16,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'x',
                      'gate_ops_list': [   {   'op': 'u3',
                                               'op_param_list': [   'pi',
                                                                    '0',
                                                                    'pi'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u3(pi,0,pi) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 21,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'y',
                      'gate_ops_list': [   {   'op': 'u3',
                                               'op_param_list': [   'pi',
                                                                    'pi/2',
                                                                    'pi/2'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u3(pi,pi/2,pi/2) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 23,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'z',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['pi'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u1(pi) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 25,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'h',
                      'gate_ops_list': [   {   'op': 'u2',
                                               'op_param_list': ['0', 'pi'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u2(0,pi) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 27,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 's',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['pi/2'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u1(pi/2) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 29,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'sdg',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['-pi/2'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u1(-pi/2) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 31,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 't',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['pi/4'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u1(pi/4) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 33,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'tdg',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['-pi/4'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u1(-pi/4) a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a'],
                      'linenum': 35,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'rx(theta)',
                      'gate_ops_list': [   {   'op': 'u3',
                                               'op_param_list': [   'theta',
                                                                    '-pi/2',
                                                                    'pi/2'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u3(theta,-pi/2,pi/2) a;'],
                      'gate_param_list': ['theta'],
                      'gate_reg_list': ['a'],
                      'linenum': 39,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'ry(theta)',
                      'gate_ops_list': [   {   'op': 'u3',
                                               'op_param_list': [   'theta',
                                                                    '0',
                                                                    '0'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u3(theta,0,0) a;'],
                      'gate_param_list': ['theta'],
                      'gate_reg_list': ['a'],
                      'linenum': 41,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'rz(phi)',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['phi'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': ['u1(phi) a;'],
                      'gate_param_list': ['phi'],
                      'gate_reg_list': ['a'],
                      'linenum': 43,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'cz',
                      'gate_ops_list': [   {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']}],
                      'gate_ops_raw_list': ['h b;', 'cx a,b;', 'h b;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 48,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'cy',
                      'gate_ops_list': [   {   'op': 'sdg',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 's',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']}],
                      'gate_ops_raw_list': ['sdg b;', 'cx a,b;', 's b;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 50,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'swap',
                      'gate_ops_list': [   {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['b', 'a']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']}],
                      'gate_ops_raw_list': ['cx a,b;', 'cx b,a;', 'cx a,b;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 52,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'ch',
                      'gate_ops_list': [   {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'sdg',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 's',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'x',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 's',
                                               'op_param_list': None,
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': [   'h b;',
                                               'sdg b;',
                                               'cx a,b;',
                                               'h b;',
                                               't b;',
                                               'cx a,b;',
                                               't b;',
                                               'h b;',
                                               's b;',
                                               'x b;',
                                               's a;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 54,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'ccx',
                      'gate_ops_list': [   {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['b', 'c']},
                                           {   'op': 'tdg',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'c']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['b', 'c']},
                                           {   'op': 'tdg',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'c']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['a']},
                                           {   'op': 'tdg',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']}],
                      'gate_ops_raw_list': [   'h c;',
                                               'cx b,c;',
                                               'tdg c;',
                                               'cx a,c;',
                                               't c;',
                                               'cx b,c;',
                                               'tdg c;',
                                               'cx a,c;',
                                               't b;',
                                               't c;',
                                               'h c;',
                                               'cx a,b;',
                                               't a;',
                                               'tdg b;',
                                               'cx a,b;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a', 'b', 'c'],
                      'linenum': 62,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'cswap',
                      'gate_ops_list': [   {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['c', 'b']},
                                           {   'op': 'ccx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b', 'c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['c', 'b']}],
                      'gate_ops_raw_list': ['cx c,b;', 'ccx a,b,c;', 'cx c,b;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a', 'b', 'c'],
                      'linenum': 73,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'crx(lambda)',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['pi/2'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'u3',
                                               'op_param_list': [   '-lambda/2',
                                                                    '0',
                                                                    '0'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'u3',
                                               'op_param_list': [   'lambda/2',
                                                                    '-pi/2',
                                                                    '0'],
                                               'op_reg_list': ['b']}],
                      'gate_ops_raw_list': [   'u1(pi/2) b;',
                                               'cx a,b;',
                                               'u3(-lambda/2,0,0) b;',
                                               'cx a,b;',
                                               'u3(lambda/2,-pi/2,0) b;'],
                      'gate_param_list': ['lambda'],
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 80,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'cry(lambda)',
                      'gate_ops_list': [   {   'op': 'u3',
                                               'op_param_list': [   'lambda/2',
                                                                    '0',
                                                                    '0'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'u3',
                                               'op_param_list': [   '-lambda/2',
                                                                    '0',
                                                                    '0'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']}],
                      'gate_ops_raw_list': [   'u3(lambda/2,0,0) b;',
                                               'cx a,b;',
                                               'u3(-lambda/2,0,0) b;',
                                               'cx a,b;'],
                      'gate_param_list': ['lambda'],
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 89,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'crz(lambda)',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['lambda/2'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'u1',
                                               'op_param_list': ['-lambda/2'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']}],
                      'gate_ops_raw_list': [   'u1(lambda/2) b;',
                                               'cx a,b;',
                                               'u1(-lambda/2) b;',
                                               'cx a,b;'],
                      'gate_param_list': ['lambda'],
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 97,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'cu1(lambda)',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': ['lambda/2'],
                                               'op_reg_list': ['a']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'u1',
                                               'op_param_list': ['-lambda/2'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'u1',
                                               'op_param_list': ['lambda/2'],
                                               'op_reg_list': ['b']}],
                      'gate_ops_raw_list': [   'u1(lambda/2) a;',
                                               'cx a,b;',
                                               'u1(-lambda/2) b;',
                                               'cx a,b;',
                                               'u1(lambda/2) b;'],
                      'gate_param_list': ['lambda'],
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 105,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'cu3(theta,phi,lambda)',
                      'gate_ops_list': [   {   'op': 'u1',
                                               'op_param_list': [   'lambda+phi)/2'],
                                               'op_reg_list': ['c']},
                                           {   'op': 'u1',
                                               'op_param_list': [   'lambda-phi)/2'],
                                               'op_reg_list': ['t']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['c', 't']},
                                           {   'op': 'u3',
                                               'op_param_list': [   'phi+lambda)/2'],
                                               'op_reg_list': ['t']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['c', 't']},
                                           {   'op': 'u3',
                                               'op_param_list': [   'theta/2',
                                                                    'phi',
                                                                    '0'],
                                               'op_reg_list': ['t']}],
                      'gate_ops_raw_list': [   'u1((lambda+phi)/2) c;',
                                               'u1((lambda-phi)/2) t;',
                                               'cx c,t;',
                                               'u3(-theta/2,0,-(phi+lambda)/2) '
                                               't;',
                                               'cx c,t;',
                                               'u3(theta/2,phi,0) t;'],
                      'gate_param_list': ['theta', 'phi', 'lambda'],
                      'gate_reg_list': ['c', 't'],
                      'linenum': 114,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'rxx(theta)',
                      'gate_ops_list': [   {   'op': 'u3',
                                               'op_param_list': [   'pi/2',
                                                                    'theta',
                                                                    '0'],
                                               'op_reg_list': ['a']},
                                           {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'u1',
                                               'op_param_list': ['-theta'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'u2',
                                               'op_param_list': [   '-pi',
                                                                    'pi-theta'],
                                               'op_reg_list': ['a']}],
                      'gate_ops_raw_list': [   'u3(pi/2,theta,0) a;',
                                               'h b;',
                                               'cx a,b;',
                                               'u1(-theta) b;',
                                               'cx a,b;',
                                               'h b;',
                                               'u2(-pi,pi-theta) a;'],
                      'gate_param_list': ['theta'],
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 125,
                      'source': None},
                  {   'filenum': 1,
                      'gate_name': 'rzz(theta)',
                      'gate_ops_list': [   {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 'u1',
                                               'op_param_list': ['theta'],
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']}],
                      'gate_ops_raw_list': [   'cx a,b;',
                                               'u1(theta) b;',
                                               'cx a,b;'],
                      'gate_param_list': ['theta'],
                      'gate_reg_list': ['a', 'b'],
                      'linenum': 136,
                      'source': None},
                  {   'filenum': 2,
                      'gate_name': 'foo',
                      'gate_ops_list': [   {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['b', 'c']},
                                           {   'op': 'tdg',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'c']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['b', 'c']},
                                           {   'op': 'tdg',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'c']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'h',
                                               'op_param_list': None,
                                               'op_reg_list': ['c']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']},
                                           {   'op': 't',
                                               'op_param_list': None,
                                               'op_reg_list': ['a']},
                                           {   'op': 'tdg',
                                               'op_param_list': None,
                                               'op_reg_list': ['b']},
                                           {   'op': 'cx',
                                               'op_param_list': None,
                                               'op_reg_list': ['a', 'b']}],
                      'gate_ops_raw_list': [   'h c;',
                                               'cx b,c;',
                                               'tdg c;',
                                               'cx a,c;',
                                               't c;',
                                               'cx b,c;',
                                               'tdg c;',
                                               'cx a,c;',
                                               't b;',
                                               't c;',
                                               'h c;',
                                               'cx a,b;',
                                               't a;',
                                               'tdg b;',
                                               'cx a,b;'],
                      'gate_param_list': None,
                      'gate_reg_list': ['a', 'b', 'c'],
                      'linenum': 3,
                      'source': None}],
    's_sect': [],
    't_sect': {   'datetime_finish': '2020-02-11T13:22:19.613315',
                  'datetime_start': '2020-02-11T13:22:19.610603',
                  'filepaths': [   'foo.qasm',
                                   '/home/jax/work/QISKit/DEV/qiskit-terra/qiskit/qasm/libs/qelib1.inc',
                                   './foogate.inc'],
                  'name': 'main'}}
Circuit:
        ┌────────────────────────┐                                            »
q_0: |0>┤ Rx(1.5707963267948966) ├──────────────■─────────────────────■────■──»
        └────────────────────────┘              │             ┌───┐   │  ┌─┴─┐»
q_1: |0>────────────────────────────■───────────┼─────────■───┤ T ├───┼──┤ X ├»
                  ┌───┐           ┌─┴─┐┌─────┐┌─┴─┐┌───┐┌─┴─┐┌┴───┴┐┌─┴─┐├───┤»
q_2: |0>──────────┤ H ├───────────┤ X ├┤ Tdg ├┤ X ├┤ T ├┤ X ├┤ Tdg ├┤ X ├┤ T ├»
                  └───┘           └───┘└─────┘└───┘└───┘└───┘└─────┘└───┘└───┘»
 c_0: 0 ══════════════════════════════════════════════════════════════════════»
                                                                              »
 c_1: 0 ══════════════════════════════════════════════════════════════════════»
                                                                              »
 c_2: 0 ══════════════════════════════════════════════════════════════════════»
                                                                              »
«      ┌───┐      
«q_0: ─┤ T ├───■──
«     ┌┴───┴┐┌─┴─┐
«q_1: ┤ Tdg ├┤ X ├
«     └┬───┬┘└───┘
«q_2: ─┤ H ├──────
«      └───┘      
«c_0: ════════════
«                 
«c_1: ════════════
«                 
«c_2: ════════════
«                 
[   {   'filenum': 0,
        'linenum': 4,
        'qreg_name': 'q',
        'qreg_num': '3',
        'source': None,
        'type': <ASTType.QREG: 20>},
    {   'creg_name': 'c',
        'creg_num': '3',
        'filenum': 0,
        'linenum': 5,
        'source': None,
        'type': <ASTType.CREG: 30>}]
```
